<!-- trainer.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Portali i Trajnerit</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    .container { background: white; padding: 20px; border-radius: 10px; max-width: 600px; margin: auto; }
    input, button, select { margin-top: 10px; padding: 10px; width: 100%; }
    ul { list-style-type: none; padding: 0; }
    li { background: #eee; padding: 10px; margin-top: 5px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
    .actions button { margin-left: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Portali i Trajnerit</h2>

    <h3>📅 Orari i Kursit</h3>
    <input id="input-orar" placeholder="Shkruaj orarin, p.sh: E enjte - 17:00">
    <button onclick="shtoOrar()">Shto Orar</button>
    <ul id="orari-list"></ul>
    <h3>👥 Studentët dhe Statusi</h3>
    <ul id="lista-studenteve-status"></ul>
    <h3>🔄 Ndrysho trajnerin e studentit</h3>
    <select id="student-list"></select>
    <input type="text" id="new-trainer-name" placeholder="Emri i ri i trajnerit">
    <button onclick="ndryshoTrajnerin()">Ndrysho Trajnerin</button>



    <h3>➕ Regjistro Student</h3>
    <input id="new-username" placeholder="Username i studentit">
    <input id="new-password" type="password" placeholder="Password">
    <button onclick="regjistroStudent()">Regjistro</button>

    <h3>🔒 Ndrysho Fjalëkalimin</h3>
    <input id="new-password-trainer" type="password" placeholder="Fjalëkalimi i ri">
    <button onclick="ndryshoPasswordTrainer()">Ndrysho</button>
    <h3>📨 Dërgo Mesazh Trajnerit</h3>
    <input id="mesazh-per-trajnerin" placeholder="Shkruaj mesazh">
    <button onclick="dergoMesazhTrajnerit()">Dërgo</button>
    <h3>📥 Mesazhet nga Studentët</h3>
    <ul id="lista-mesazheve"></ul>



    <h3>💬 Komunikim me Studentët</h3>
    <input id="mesazh" placeholder="Shkruaj mesazh">
    <button onclick="dergoMesazh()">Dërgo</button>
  </div>

  <script>
    // Ngarko oraret nga localStorage
    function ngarkoOraret() {
      const lista = document.getElementById('orari-list');
      lista.innerHTML = "";
      const oraret = JSON.parse(localStorage.getItem('oraret') || "[]");

      oraret.forEach((orar, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${orar}</span>
          <div class="actions">
            <button onclick="editoOrar(${index})">✏️</button>
            <button onclick="fshiOrar(${index})">🗑️</button>
          </div>`;
        lista.appendChild(li);
      });
    }

    function shtoOrar() {
      const orar = document.getElementById('input-orar').value;
      if (!orar) return;
      const oraret = JSON.parse(localStorage.getItem('oraret') || "[]");
      oraret.push(orar);
      localStorage.setItem('oraret', JSON.stringify(oraret));
      document.getElementById('input-orar').value = "";
      ngarkoOraret();
    }

    function fshiOrar(index) {
      const oraret = JSON.parse(localStorage.getItem('oraret') || "[]");
      oraret.splice(index, 1);
      localStorage.setItem('oraret', JSON.stringify(oraret));
      ngarkoOraret();
    }

    function editoOrar(index) {
      const oraret = JSON.parse(localStorage.getItem('oraret') || "[]");
      const orariRi = prompt("Shkruaj orarin e ri:", oraret[index]);
      if (orariRi) {
        oraret[index] = orariRi;
        localStorage.setItem('oraret', JSON.stringify(oraret));
        ngarkoOraret();
      }
    }

    function regjistroStudent() {
      const username = document.getElementById('new-username').value;
      const password = document.getElementById('new-password').value;
      localStorage.setItem('student_' + username, password);
      alert('Studenti u regjistrua!');
    }
    function mbushDropdownStudente() {
      const dropdown = document.getElementById("student-list");
      dropdown.innerHTML = "";
      for (let key in localStorage) {
        if (key.startsWith("student_")) {
          const studentName = key.replace("student_", "");
          const option = document.createElement("option");
          option.value = studentName;
          option.text = studentName;
          dropdown.appendChild(option);
        }
      }
}

function ndryshoTrajnerin() {
  const studenti = document.getElementById("student-list").value;
  const emriTrajnerit = document.getElementById("new-trainer-name").value.trim();
  if (!emriTrajnerit) {
    alert("Ju lutem shkruani emrin e trajnerit.");
    return;
  }

  localStorage.setItem("trainer_for_student_" + studenti, emriTrajnerit);
  alert("Trajneri për " + studenti + " u ndryshua në: " + emriTrajnerit);
}

window.onload = function () {
  ngarkoOraret();
  shfaqStatusStudentesh();
  mbushDropdownStudente();
}


    function ndryshoPasswordTrainer() {
      const newPass = document.getElementById('new-password-trainer').value;
      localStorage.setItem('trainer_password', newPass);
      alert('Fjalëkalimi i trajnerit u ndryshua!');
    }

    function dergoMesazh() {
      const msg = document.getElementById('mesazh').value;
      localStorage.setItem('mesazhi_trajnerit', msg);
      alert('Mesazhi u dërgua te studentët!');
    }
    function shfaqMesazhetStudenteve() {
      const lista = document.getElementById("lista-mesazheve");
      lista.innerHTML = "";
      const mesazhet = JSON.parse(localStorage.getItem("mesazhet_e_studenteve") || "[]");
    
      if (mesazhet.length === 0) {
        lista.innerHTML = "<li>Nuk ka asnjë mesazh.</li>";
        return;
      }

  mesazhet.forEach(m => {
    const li = document.createElement("li");
    li.textContent = `📨 ${m.nga}: ${m.mesazh}`;
    lista.appendChild(li);
  });
}

    function dergoMesazhTrajnerit() {
      const username = localStorage.getItem("current_student") || "student_anonim";
      const mesazhi = document.getElementById("mesazh-per-trajnerin").value.trim();
    
      if (!mesazhi) {
        alert("Ju lutem shkruani një mesazh.");
        return;
      }
    
      let lista = JSON.parse(localStorage.getItem("mesazhet_e_studenteve") || "[]");
      lista.push({ nga: username, mesazh: mesazhi });
      localStorage.setItem("mesazhet_e_studenteve", JSON.stringify(lista));
    
      document.getElementById("mesazh-per-trajnerin").value = "";
      alert("Mesazhi u dërgua!");
    }


    // Thirrja kryesore për të ngarkuar oraret
    window.onload = ngarkoOraret;
    function shfaqStatusStudentesh() {
      const lista = document.getElementById("lista-studenteve-status");
      lista.innerHTML = "";
    
      for (let key in localStorage) {
        if (key.startsWith("student_")) {
          const username = key.replace("student_", "");
          const status = localStorage.getItem("student_status_" + username) || "nuk ka zgjedhur";
          const emoji = status === "online" ? "🟢"
                      : status === "busy" ? "🟠"
                      : status === "invisible" ? "⚫"
                      : "❓";
    
          const li = document.createElement("li");
          li.textContent = `${emoji} ${username} - ${status}`;
          lista.appendChild(li);
        }
      }
    }
    
    // Ngarko listën e statuseve kur hapet faqja
    window.onload = function() {
      ngarkoOraret();
      shfaqStatusStudentesh();
      shfaqMesazhetStudenteve();

    }

  </script>
</body>
</html>
